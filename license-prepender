#!/bin/bash

ARGC=$#

if [[ $ARGC < 4 || $ARGC > 5 ]]; then
    echo "Error. Usage: ./license-prepender <REPO_PATH> <LICENSE_NAME> <YEAR> <AUTHOR> [PROGRAM_DESCRIPTION]"
    exit
fi

source <(curl -s https://raw.githubusercontent.com/silvagpmiguel/license-prepender/main/src/license_env)
source <(curl -s https://raw.githubusercontent.com/silvagpmiguel/license-prepender/main/src/functions) --source-only

if [[ "${LICENSES[$LICENSE_NAME]}" != "" ]]; then
    addLicense
fi
if [[ "${BOILERPLATES[$LICENSE_NAME]}" != "" ]]; then
    getLicenseBoilerplate
    HAS_BOILERPLATE=true
fi

for key in "${!SUPPORTED[@]}"; do
    FOUND_PATHS=$(find "$REPO_PATH" -type f -name "*$key")
    case "${SUPPORTED[$key]}" in
        "//")
            prepend "$key" "${FOUND_PATHS[@]}" "" "" "// " ${HAS_BOILERPLATE}
        ;;
        "/*")
            prepend "$key" "${FOUND_PATHS[@]}" "/*\n" " */" " * " ${HAS_BOILERPLATE}
        ;;  
        "<!--")
            prepend "$key" "${FOUND_PATHS[@]}" "<!--\n" "-->" "~ " ${HAS_BOILERPLATE}
        ;;
    esac
done